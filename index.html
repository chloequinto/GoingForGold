<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
    <script src="p5.js"></script>
    <!-- <script scr="index.js"></script> -->
</head>

<body>

    <video id="video" src="/video/tennis_serving.mp4"></video>
    <canvas id="thecanvas" width="800" height="600"></canvas>
</body>

<script>
    //Variables
    var keypoints;
    var i;
    var minPartConfidence;


    function setup() {
        createCanvas(800, 600);
        background(10, 0, 0);
        i = 0;
        minPartConfidence = 0.3;

    }

    video.addEventListener('loadeddata', function() {
        this.currentTime = i;
        console.log(i);
    });

    video.addEventListener('loadeddata', function() {
        var duration = video.duration;
        var i = 0;
        var interval = setInterval(function() {
            video.currentTime = i;
            generateThumbnail(i);
            i = i + 1;
            if (i > duration) clearInterval(interval);
        }, 200);
    });



    function generateThumbnail(i) {

        var context = thecanvas.getContext('2d');
        context.drawImage(video, 0, 0, 800, 600);
        var dataURL = thecanvas.toDataURL();
        var img = document.createElement('img');
        img.setAttribute('src', dataURL);
        document.getElementById('thecanvas').appendChild(img);
        posenet.load().then(function(net) {
            const pose = net.estimateSinglePose(img, {
                flipHorizontal: true
            });
            return pose;
        }).then(function(pose) {
            console.log(pose);
            keypoints = pose.keypoints;
            draw();
        })
    }





    video.addEventListener('seeked', function() {
        generateThumbnail(i);
        i += 0.5;
        if (i <= this.duration) {
            this.currentTime = i;
        } else {
            // Do something idk 
        }
    });
    //onload call setup
    window.onload = setup;
</script>

</html>